length(itemLabels(data))
# ¿Cómo es la distribución de la frecuencia de los productos?
itemFrequencyPlot(data,
support = 0.01,
type = "relative",
main = "Frecuencia relativa de productos (>= 1%)")
# ¿Existen transacciones con muy pocos artículos o muchas?
summary(size(data))
boxplot(size(data),
main = "Distribución del tamaño de las transacciones",
ylab = "Número de artículos")
# ¿Existen transacciones con muy pocos artículos o muchas?
summary(size(data))
boxplot(size(data),
main = "Distribución del tamaño de las transacciones",
xlab = "Número de artículos",
horizontal = TRUE)
rules <- apriori(data,
parameter = list(supp = 0.01, conf = 0.2, minlen = 2))
rules_sorted <- sort(rules, by = "lift", decreasing = TRUE)
inspect(head(rules_sorted, 10))  # Las 10 reglas con mayor lift
library(arulesViz)
plot(rules_sorted[1:20], method = "graph", engine = "htmlwidget")
plot(rules_sorted[1:20], method = "grouped")
inspect(head(sort(rules, by = "lift"), 10))  # Ver las 10 mejores
# Visualizar
library(arulesViz)
plot(head(sort(rules, by = "lift"), 10),
method = "graph",
engine = "htmlwidget")
# ------------------------------------------------------------------------------
# ACTIVIDAD APLICADA 8
# Autor: Carolina Dougnac V.
# ------------------------------------------------------------------------------
# 0. Cargar librerías y datos
# ------------------------------------------------------------------------------
# Cargar paquetes
library(readxl)
library(readr)
library(arules)
library(arulesViz)
library(magrittr)
library(dplyr)
library(lubridate)
library(forcats)
library(ggplot2)
library(mbar)
# Remover los objetos de R
rm(list=ls())
data <- read.transactions(file.choose(), format = "basket", sep = ",")
# Revisión inicial de estructura y datos faltantes
str(data)
dim(data)
# ------------------------------------------------------------------------------
# 1. Haga un gráfico que visualice los 8 artículos más comprados. Interprete.
# ------------------------------------------------------------------------------
itemFrequencyPlot(data,
topN = 8,
type = "absolute",
col = "steelblue",
main = "Top 8 productos más comprados")
# ¿Cuántos productos se compran por transacción en promedio?
num_items <- size(data)
summary(num_items)
mean(num_items)  # Promedio de productos por transacción
hist(num_items,
col = "lightblue",
main = "Distribución del número de artículos por transacción",
xlab = "Número de artículos",
breaks = 30)
# ¿Cómo es la distribución de la frecuencia de los productos?
itemFrequencyPlot(data,
support = 0.01,
type = "relative",
main = "Frecuencia relativa de productos (>= 1%)")
# ¿Existen transacciones con muy pocos artículos o muchas?
summary(size(data))
boxplot(size(data),
main = "Distribución del tamaño de las transacciones",
xlab = "Número de artículos",
horizontal = TRUE)
# ------------------------------------------------------------------------------
# ACTIVIDAD APLICADA 8
# Autor: Carolina Dougnac V.
# ------------------------------------------------------------------------------
# 0. Cargar librerías y datos
# ------------------------------------------------------------------------------
# Cargar paquetes
library(readxl)
library(readr)
library(arules)
library(arulesViz)
library(magrittr)
library(dplyr)
library(lubridate)
library(forcats)
library(ggplot2)
library(mbar)
# Remover los objetos de R
rm(list=ls())
data <- read.transactions(file.choose(), format = "basket", sep = ",")
# Revisión inicial de estructura y datos faltantes
str(data)
dim(data)
# ------------------------------------------------------------------------------
# 1. Haga un gráfico que visualice los 8 artículos más comprados. Interprete.
# ------------------------------------------------------------------------------
itemFrequencyPlot(data,
topN = 8,
type = "absolute",
col = "steelblue",
main = "Top 8 productos más comprados")
# ¿Cuántos productos se compran por transacción en promedio?
num_items <- size(data)
summary(num_items)
mean(num_items)  # Promedio de productos por transacción
hist(num_items,
col = "lightblue",
main = "Distribución del número de artículos por transacción",
xlab = "Número de artículos",
breaks = 30)
# ¿Cómo es la distribución de la frecuencia de los productos?
itemFrequencyPlot(data,
support = 0.01,
type = "relative",
main = "Frecuencia relativa de productos (>= 1%)")
# ¿Existen transacciones con muy pocos artículos o muchas?
summary(size(data))
boxplot(size(data),
main = "Distribución del tamaño de las transacciones",
xlab = "Número de artículos",
horizontal = TRUE)
rules_filtered <- subset(rules, confidence > 0.2 & lift > 1.2)
rules_filtered <- rules[quality(rules)$confidence > 0.2 & quality(rules)$lift > 1.2]
rules_filtered <- subset(rules, subset = quality(rules)$confidence > 0.2 & quality(rules)$lift > 1.2)
class(rules)
rules <- apriori(data, parameter = list(supp = 0.01, conf = 0.2, minlen = 2))
rules_filtered <- subset(rules, subset = confidence > 0.2 & lift > 1.2)
inspect(head(sort(rules_filtered, by = "lift", decreasing = TRUE), 10))
rules <- apriori(data,
parameter = list(supp = 0.01, conf = 0.5, minlen = 2, maxlen=5))
length(rules)
inspect(head(sort(rules, by = "lift"), 10))  # Ver las 10 mejores
# Visualizar
library(arulesViz)
plot(head(sort(rules, by = "lift"), 10),
method = "graph",
engine = "htmlwidget")
inspect(head(sort(rules, by = "lift"), 10))  # Ver las 10 mejores
# Visualizar
library(arulesViz)
plot(head(sort(rules, by = "lift"), 10),
method = "graph",
engine = "htmlwidget")
inspect(head(sort(rules, by = "lift"), 10))  # Ver las 10 mejores
inspect(head(sort(rules, by = "confidence"), 10))  # Ver las 10 mejores
# Visualizar
library(arulesViz)
plot(head(sort(rules, by = "confidence"), 10),
method = "graph",
engine = "htmlwidget")
# ------------------------------------------------------------------------------
# ACTIVIDAD APLICADA 8
# Autor: Carolina Dougnac V.
# ------------------------------------------------------------------------------
# 0. Cargar librerías y datos
# ------------------------------------------------------------------------------
# Cargar paquetes
library(readxl)
library(readr)
library(arules)
library(arulesViz)
library(magrittr)
library(dplyr)
library(lubridate)
library(forcats)
library(ggplot2)
library(mbar)
# Remover los objetos de R
rm(list=ls())
data <- read.transactions(file.choose(), format = "basket", sep = ",")
# Revisión inicial de estructura y datos faltantes
str(data)
dim(data)
# ------------------------------------------------------------------------------
# 1. Haga un gráfico que visualice los 8 artículos más comprados. Interprete.
# ------------------------------------------------------------------------------
itemFrequencyPlot(data,
topN = 8,
type = "absolute",
col = "steelblue",
main = "Top 8 productos más comprados")
# ¿Cuántos productos se compran por transacción en promedio?
num_items <- size(data)
summary(num_items)
mean(num_items)  # Promedio de productos por transacción
hist(num_items,
col = "lightblue",
main = "Distribución del número de artículos por transacción",
xlab = "Número de artículos",
breaks = 30)
# ¿Cómo es la distribución de la frecuencia de los productos?
itemFrequencyPlot(data,
support = 0.01,
type = "relative",
main = "Frecuencia relativa de productos (>= 1%)")
# ¿Existen transacciones con muy pocos artículos o muchas?
summary(size(data))
boxplot(size(data),
main = "Distribución del tamaño de las transacciones",
xlab = "Número de artículos",
horizontal = TRUE)
# ------------------------------------------------------------------------------
# 2 Entrene un algoritmo a priori. ------------- y -------------------
# 3 Discuta la elección de los hiperparámetros del algoritmo a priori.
# ------------------------------------------------------------------------------
rules <- apriori(data,
parameter = list(supp = 0.01, conf = 0.5, minlen = 2, maxlen=5))
length(rules)
# ------------------------------------------------------------------------------
# 4 Visualice las 10 mejores reglas. Comente.
# ------------------------------------------------------------------------------
inspect(head(sort(rules, by = "confidence"), 10))  # Ver las 10 mejores
# Visualizar
library(arulesViz)
plot(head(sort(rules, by = "confidence"), 10),
method = "graph",
engine = "htmlwidget")
# ------------------------------------------------------------------------------
# 5 Interprete algunas reglas encontradas (por lo menos 3).
# ------------------------------------------------------------------------------
# Visualizar
library(arulesViz)
plot(head(sort(rules, by = "confidence"), 15),
method = "graph",
engine = "htmlwidget")
# ------------------------------------------------------------------------------
# ACTIVIDAD APLICADA 8
# Autor: Carolina Dougnac V.
# ------------------------------------------------------------------------------
# 0. Cargar librerías y datos
# ------------------------------------------------------------------------------
# Cargar paquetes
library(readxl)
library(readr)
library(arules)
library(arulesViz)
library(magrittr)
library(dplyr)
library(lubridate)
library(forcats)
library(ggplot2)
library(mbar)
# Remover los objetos de R
rm(list=ls())
data <- read.transactions(file.choose(), format = "basket", sep = ",")
# Revisión inicial de estructura y datos faltantes
str(data)
dim(data)
# ------------------------------------------------------------------------------
# 1. Haga un gráfico que visualice los 8 artículos más comprados. Interprete.
# ------------------------------------------------------------------------------
itemFrequencyPlot(data,
topN = 8,
type = "absolute",
col = "steelblue",
main = "Top 8 productos más comprados")
# ¿Cuántos productos se compran por transacción en promedio?
num_items <- size(data)
summary(num_items)
mean(num_items)  # Promedio de productos por transacción
hist(num_items,
col = "lightblue",
main = "Distribución del número de artículos por transacción",
xlab = "Número de artículos",
breaks = 30)
# ¿Cómo es la distribución de la frecuencia de los productos?
itemFrequencyPlot(data,
support = 0.01,
type = "relative",
main = "Frecuencia relativa de productos (>= 1%)")
# ¿Existen transacciones con muy pocos artículos o muchas?
summary(size(data))
boxplot(size(data),
main = "Distribución del tamaño de las transacciones",
xlab = "Número de artículos",
horizontal = TRUE)
# ------------------------------------------------------------------------------
# 2 Entrene un algoritmo a priori. ------------- y -------------------
# 3 Discuta la elección de los hiperparámetros del algoritmo a priori.
# ------------------------------------------------------------------------------
rules <- apriori(data,
parameter = list(supp = 0.01, conf = 0.5, minlen = 2, maxlen=5))
length(rules)
# ------------------------------------------------------------------------------
# 4 Visualice las 10 mejores reglas. Comente.
# ------------------------------------------------------------------------------
inspect(head(sort(rules, by = "confidence"), 10))  # Ver las 10 mejores
# Visualizar
library(arulesViz)
plot(head(sort(rules, by = "confidence"), 15),
method = "graph",
engine = "htmlwidget")
# ------------------------------------------------------------------------------
# 5 Interprete algunas reglas encontradas (por lo menos 3).
# ------------------------------------------------------------------------------
# 99_utils_metricas.R
calcular_metricas <- function(y_real, y_pred) {
y_real <- as.numeric(y_real)
y_pred <- as.numeric(y_pred)
# RMSE
rmse_val <- sqrt(mean((y_real - y_pred)^2, na.rm = TRUE))
# MAE
mae_val <- mean(abs(y_real - y_pred), na.rm = TRUE)
# R^2
ss_res <- sum((y_real - y_pred)^2, na.rm = TRUE)
ss_tot <- sum((y_real - mean(y_real, na.rm = TRUE))^2, na.rm = TRUE)
r2_val <- 1 - ss_res / ss_tot
data.frame(
RMSE = rmse_val,
MAE  = mae_val,
R2   = r2_val
)
}
# 01_exploracion.R
library(tidyverse)
library(caret)
set.seed(123)
# 1) Leer datos
setwd("/Users/carolinadougnacvaldivia/RStudio_UAI/ml-banking-revenue")
data_path <- file.path("data", "BankRevenue.csv")
bank <- read.csv(data_path, stringsAsFactors = FALSE)
# 2) Vista general
glimpse(bank)
summary(bank$Rev_Total)
# 3) Tratamiento básico (ejemplos, ajusta según tus variables)
# - Elimina ID si existe
bank <- bank %>% select(-matches("id|ID|Id"))
# 4) Train / Test split (80/20 estratificado en Rev_Total “cortado”)
bank$Rev_cat <- cut(bank$Rev_Total,
breaks = quantile(bank$Rev_Total, probs = seq(0, 1, 0.2), na.rm = TRUE),
include.lowest = TRUE)
set.seed(123)
train_idx <- createDataPartition(bank$Rev_cat, p = 0.8, list = FALSE)
train_data <- bank[train_idx, ] %>% select(-Rev_cat)
test_data  <- bank[-train_idx, ] %>% select(-Rev_cat)
# 5) Guardar datasets ya limpiados y particionados
saveRDS(train_data, "outputs/train_data.rds")
saveRDS(test_data,  "outputs/test_data.rds")
# 02_modelos_lineales.R
library(tidyverse)
library(caret)
library(glmnet)
source("99_utils_metricas.R")
set.seed(123)
train_data <- readRDS("outputs/train_data.rds")
test_data  <- readRDS("outputs/test_data.rds")
# 1) Definir fórmula
target <- "Rev_Total"
predictors <- setdiff(names(train_data), target)
form <- as.formula(paste(target, "~", paste(predictors, collapse = " + ")))
# 2) Configuración de entrenamiento caret
ctrl <- trainControl(
method = "repeatedcv",
number = 5,
repeats = 3,
verboseIter = FALSE
)
# 3) Elastic Net (alpha entre 0 y 1)
grid_en <- expand.grid(
alpha = seq(0, 1, by = 0.25),
lambda = 10^seq(-3, 1, length = 20)
)
modelo_en <- train(
form,
data = train_data,
method = "glmnet",
trControl = ctrl,
tuneGrid = grid_en,
metric = "RMSE"
)
# Mejor combinación alpha-lambda
modelo_en$bestTune
# 4) Predicciones
pred_train <- predict(modelo_en, newdata = train_data)
pred_test  <- predict(modelo_en, newdata = test_data)
met_train <- calcular_metricas(train_data[[target]], pred_train)
met_test  <- calcular_metricas(test_data[[target]], pred_test)
metricas_lineal <- bind_rows(
met_train %>% mutate(Conjunto = "Train", Modelo = "ElasticNet"),
met_test  %>% mutate(Conjunto = "Test",  Modelo = "ElasticNet")
)
print(metricas_lineal)
# 5) Guardar
saveRDS(modelo_en, "outputs/modelo_elasticnet.rds")
write.csv(metricas_lineal, "outputs/metricas_lineal.csv", row.names = FALSE)
library(tidyverse)
library(caret)
library(rpart)
library(randomForest)  # asegúrate de tenerlo instalado: install.packages("randomForest")
# Cargar la función calcular_metricas()
source("99_utils_metricas.R")
set.seed(123)
# 1) Cargar datos
train_data <- readRDS("outputs/train_data.rds")
test_data  <- readRDS("outputs/test_data.rds")
# 2) Definir fórmula
target <- "Rev_Total"
predictors <- setdiff(names(train_data), target)
form <- as.formula(paste(target, "~", paste(predictors, collapse = " + ")))
# 3) Control de entrenamiento
ctrl <- trainControl(
method = "cv",
number = 3
)
# 4) Árbol de regresión
grid_tree <- expand.grid(cp = seq(0.001, 0.05, by = 0.005))
modelo_tree <- train(
form,
data = train_data,
method = "rpart",
trControl = ctrl,
tuneGrid = grid_tree,
metric = "RMSE"
)
# 5) Random Forest
grid_rf <- expand.grid(
mtry = c(3, 5, 10)
)
modelo_rf <- train(
form,
data = train_data,
method = "rf",
trControl = ctrl,
tuneGrid = grid_rf,
metric = "RMSE",
importance = TRUE
)
# 6) Función auxiliar para métricas
calc_met <- function(modelo, nombre_modelo) {
pred_tr <- predict(modelo, newdata = train_data)
pred_te <- predict(modelo, newdata = test_data)
met_tr <- calcular_metricas(train_data[[target]], pred_tr) %>%
mutate(Conjunto = "Train", Modelo = nombre_modelo)
met_te <- calcular_metricas(test_data[[target]], pred_te) %>%
mutate(Conjunto = "Test", Modelo = nombre_modelo)
bind_rows(met_tr, met_te)
}
# 7) Métricas árbol + RF
metricas_tree_rf <- bind_rows(
calc_met(modelo_tree, "Arbol"),
calc_met(modelo_rf,   "RandomForest")
)
# Mostrar en consola
print(metricas_tree_rf)
# 8) Importancia de variables RF
print(varImp(modelo_rf))
# 9) Guardar modelos y métricas
saveRDS(modelo_tree, "outputs/modelo_tree.rds")
saveRDS(modelo_rf,   "outputs/modelo_rf.rds")
write.csv(metricas_tree_rf, "outputs/metricas_tree_rf.csv", row.names = FALSE)
# 04_modelos_knn.R
library(tidyverse)
library(caret)
source("99_utils_metricas.R")
set.seed(123)
train_data <- readRDS("outputs/train_data.rds")
test_data  <- readRDS("outputs/test_data.rds")
target <- "Rev_Total"
predictors <- setdiff(names(train_data), target)
form <- as.formula(paste(target, "~", paste(predictors, collapse = " + ")))
ctrl <- trainControl(
method = "repeatedcv",
number = 5,
repeats = 3
)
grid_knn <- expand.grid(
k = seq(3, 25, by = 2)
)
modelo_knn <- train(
form,
data = train_data,
method = "knn",
trControl = ctrl,
tuneGrid = grid_knn,
metric = "RMSE"
)
pred_train <- predict(modelo_knn, newdata = train_data)
pred_test  <- predict(modelo_knn, newdata = test_data)
metricas_knn <- bind_rows(
calcular_metricas(train_data[[target]], pred_train) %>%
mutate(Conjunto = "Train", Modelo = "KNN"),
calcular_metricas(test_data[[target]], pred_test) %>%
mutate(Conjunto = "Test", Modelo = "KNN")
)
print(metricas_knn)
saveRDS(modelo_knn, "outputs/modelo_knn.rds")
write.csv(metricas_knn, "outputs/metricas_knn.csv", row.names = FALSE)
# 05_resumen_metricas.R
library(tidyverse)
metricas_lineal    <- read.csv("outputs/metricas_lineal.csv")
metricas_tree_rf   <- read.csv("outputs/metricas_tree_rf.csv")
metricas_knn       <- read.csv("outputs/metricas_knn.csv")
metricas_total <- bind_rows(
metricas_lineal,
metricas_tree_rf,
metricas_knn
)
write.csv(metricas_total, "outputs/resultados_metricas.csv", row.names = FALSE)
metricas_total %>%
filter(Conjunto == "Test") %>%
arrange(RMSE)
